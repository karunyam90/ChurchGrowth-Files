
const Samathanam = ["https://videos.churchgrowthfollowupministry.org/female_videos/samathanam-video-1-2/",
                    "https://videos.churchgrowthfollowupministry.org/female_videos/samathanam-video-2-2/",
                    "https://videos.churchgrowthfollowupministry.org/female_videos/samathanam-video-3/",
                    "https://videos.churchgrowthfollowupministry.org/female_videos/samathanam-video-4/",
                    "https://videos.churchgrowthfollowupministry.org/female_videos/samathanam-video-5/",
                    "https://videos.churchgrowthfollowupministry.org/female_videos/samathanam-video-6/",
                    "https://videos.churchgrowthfollowupministry.org/female_videos/samathanam-video-7/",
                    "https://videos.churchgrowthfollowupministry.org/female_videos/samathanam-video-8/",
                    "https://videos.churchgrowthfollowupministry.org/female_videos/samathanam-video-9/",
                    "https://videos.churchgrowthfollowupministry.org/female_videos/samathanam-video-10/",
                    "https://videos.churchgrowthfollowupministry.org/female_videos/samathanam-video-11/",
                    "https://videos.churchgrowthfollowupministry.org/female_videos/samathanam-video-12/",
                    "https://videos.churchgrowthfollowupministry.org/female_videos/samathanam-video-13/",
                    "https://videos.churchgrowthfollowupministry.org/female_videos/samathanam-video-14/",
                    "https://videos.churchgrowthfollowupministry.org/female_videos/samathanam-video-15/",
                    "https://videos.churchgrowthfollowupministry.org/female_videos/samathanam-video-16/",
                    "https://videos.churchgrowthfollowupministry.org/female_videos/samathanam-video-17/",
                    "https://videos.churchgrowthfollowupministry.org/female_videos/samathanam-video-18/",
                    "https://videos.churchgrowthfollowupministry.org/female_videos/samathanam-video-19/",
                    "https://videos.churchgrowthfollowupministry.org/female_videos/samathanam-video-20/",
                    "https://videos.churchgrowthfollowupministry.org/female_videos/samathanam-video-21/",
                    "https://videos.churchgrowthfollowupministry.org/female_videos/samathanam-video-22/"];
                    
const Viduthalai = ["https://videos.churchgrowthfollowupministry.org/female_videos/viduthalai-female-1/",
                    "https://videos.churchgrowthfollowupministry.org/female_videos/viduthalai-video-2/",
                    "https://videos.churchgrowthfollowupministry.org/female_videos/viduthalai-video-3/",
                    "https://videos.churchgrowthfollowupministry.org/female_videos/viduthalai-video-4/",
                    "https://videos.churchgrowthfollowupministry.org/female_videos/viduthalai-video-5/",
                    "https://videos.churchgrowthfollowupministry.org/female_videos/viduthalai-video-6/",
                    "https://videos.churchgrowthfollowupministry.org/female_videos/viduthalai-video-7/",
                    "https://videos.churchgrowthfollowupministry.org/female_videos/viduthalai-video-8/",
                    "https://videos.churchgrowthfollowupministry.org/female_videos/viduthalai-video-9/",
                    "https://videos.churchgrowthfollowupministry.org/female_videos/viduthalai-video-10/",
                    "https://videos.churchgrowthfollowupministry.org/female_videos/viduthalai-video-11/",
                    "https://videos.churchgrowthfollowupministry.org/female_videos/viduthalai-video-12/",
                    "https://videos.churchgrowthfollowupministry.org/female_videos/viduthalai-video-13/",
                    "https://videos.churchgrowthfollowupministry.org/female_videos/viduthalai-video-14/",
                    "https://videos.churchgrowthfollowupministry.org/female_videos/viduthalai-video-15/",
                    "https://videos.churchgrowthfollowupministry.org/female_videos/viduthalai-video-16/",
                    "https://videos.churchgrowthfollowupministry.org/female_videos/viduthalai-video-17/",
                    "https://videos.churchgrowthfollowupministry.org/female_videos/viduthalai-video-18/",
                    "https://videos.churchgrowthfollowupministry.org/female_videos/viduthalai-video-19/",
                    "https://videos.churchgrowthfollowupministry.org/female_videos/viduthalai-video-20/",
                    "https://videos.churchgrowthfollowupministry.org/female_videos/viduthalai-video-21/",
                    "https://videos.churchgrowthfollowupministry.org/female_videos/viduthalai-video-22/"];
                    
  const Sugam = ["https://videos.churchgrowthfollowupministry.org/female_videos/sugam-video-1/",
                "https://videos.churchgrowthfollowupministry.org/female_videos/sugam-video-2/",
                "https://videos.churchgrowthfollowupministry.org/female_videos/sugam-video-3/",
                "https://videos.churchgrowthfollowupministry.org/female_videos/sugam-video-4/",
                "https://videos.churchgrowthfollowupministry.org/female_videos/sugam-video-5/",
                "https://videos.churchgrowthfollowupministry.org/female_videos/sugam-video-6/",
                "https://videos.churchgrowthfollowupministry.org/female_videos/sugam-video-7/",
                "https://videos.churchgrowthfollowupministry.org/female_videos/sugam-video-8/",
                "https://videos.churchgrowthfollowupministry.org/female_videos/sugam-video-9/",
                "https://videos.churchgrowthfollowupministry.org/female_videos/sugam-video-10/",
                "https://videos.churchgrowthfollowupministry.org/female_videos/sugam-video-11/",
                "https://videos.churchgrowthfollowupministry.org/female_videos/sugam-video-12/",
                "https://videos.churchgrowthfollowupministry.org/female_videos/sugam-video-13/",
                "https://videos.churchgrowthfollowupministry.org/female_videos/sugam-video-14/",
                "https://videos.churchgrowthfollowupministry.org/female_videos/sugam-video-15/",
                "https://videos.churchgrowthfollowupministry.org/female_videos/sugam-video-16/",
                "https://videos.churchgrowthfollowupministry.org/female_videos/sugam-video-17/",
                "https://videos.churchgrowthfollowupministry.org/female_videos/sugam-video-18/",
                "https://videos.churchgrowthfollowupministry.org/female_videos/sugam-video-19/",
               "https://videos.churchgrowthfollowupministry.org/female_videos/sugam-video-20/",
               "https://videos.churchgrowthfollowupministry.org/female_videos/sugam-video-21/",
               "https://videos.churchgrowthfollowupministry.org/female_videos/sugam-video-22/"];
                
  const Manamthirumbuthal = ["https://videos.churchgrowthfollowupministry.org/female_videos/manamthirumbu-video-1/",
                          "https://videos.churchgrowthfollowupministry.org/female_videos/manamthirumbu-video-2/",
                          "https://videos.churchgrowthfollowupministry.org/female_videos/manamthirumbu-video-2-2/",
                          "https://videos.churchgrowthfollowupministry.org/female_videos/manamthirumbu-video-4/",
                          "https://videos.churchgrowthfollowupministry.org/female_videos/manamthirumbu-video-5/",
                          "https://videos.churchgrowthfollowupministry.org/female_videos/manamthirumbu-video-6/",
                          "https://videos.churchgrowthfollowupministry.org/female_videos/manamthirumbu-video-7/",
                          "https://videos.churchgrowthfollowupministry.org/female_videos/manamthirumbu-video-8/",
                          "https://videos.churchgrowthfollowupministry.org/female_videos/manamthirumbu-video-9/",
                          "https://videos.churchgrowthfollowupministry.org/female_videos/manamthirumbu-video-10/",
                          "https://videos.churchgrowthfollowupministry.org/female_videos/manamthirumbu-video-11/",
                          "https://videos.churchgrowthfollowupministry.org/female_videos/manamthirumbu-video-12/",
                          "https://videos.churchgrowthfollowupministry.org/female_videos/manamthirumbu-video-13/",
                          "https://videos.churchgrowthfollowupministry.org/female_videos/manamthirumbu-video-14/",
                          "https://videos.churchgrowthfollowupministry.org/female_videos/manamthirumbu-video-15/",
                          "https://videos.churchgrowthfollowupministry.org/female_videos/manamthirumbu-video-16/",
                          "https://videos.churchgrowthfollowupministry.org/female_videos/manamthirumbu-video-17/",
                          "https://videos.churchgrowthfollowupministry.org/female_videos/manamthirumbu-video-18/",
                          "https://videos.churchgrowthfollowupministry.org/female_videos/manamthirumbu-video-20/",
                          "https://videos.churchgrowthfollowupministry.org/female_videos/manamthirumbu-video-20-2/",
                          "https://videos.churchgrowthfollowupministry.org/female_videos/manamthirumbu-video-21/",
                          "https://videos.churchgrowthfollowupministry.org/female_videos/manamthirumbu-video-22/"];
  
  const Asirvatham = ["https://videos.churchgrowthfollowupministry.org/female_videos/asirvatham-video-1/",
                      "https://videos.churchgrowthfollowupministry.org/female_videos/asirvatham-video-2/",
                      "https://videos.churchgrowthfollowupministry.org/female_videos/asirvatham-video-3/",
                      "https://videos.churchgrowthfollowupministry.org/female_videos/asirvatham-video-4/",
                      "https://videos.churchgrowthfollowupministry.org/female_videos/asirvatham-video-5/",
                      "https://videos.churchgrowthfollowupministry.org/female_videos/asirvatham-video-6/",
                      "https://videos.churchgrowthfollowupministry.org/female_videos/asirvatham-video-7/",
                      "https://videos.churchgrowthfollowupministry.org/female_videos/asirvatham-video-8/",
                      "https://videos.churchgrowthfollowupministry.org/female_videos/asirvatham-video-9/",
                      "https://videos.churchgrowthfollowupministry.org/female_videos/asirvatham-video-10/",
                      "https://videos.churchgrowthfollowupministry.org/female_videos/asirvatham-video-11/",
                      "https://videos.churchgrowthfollowupministry.org/female_videos/asirvatham-video-12/",
                      "https://videos.churchgrowthfollowupministry.org/female_videos/asirvatham-video-13/",
                      "https://videos.churchgrowthfollowupministry.org/female_videos/asirvatham-video-15/",
                      "https://videos.churchgrowthfollowupministry.org/female_videos/asirvatham-video-15-2/",
                      "https://videos.churchgrowthfollowupministry.org/female_videos/asirvatham-video-16/",
                      "https://videos.churchgrowthfollowupministry.org/female_videos/asirvatham-video-17/",
                      "https://videos.churchgrowthfollowupministry.org/female_videos/asirvatham-video-18/",
                      "https://videos.churchgrowthfollowupministry.org/female_videos/asirvatham-video-19/",
                      "https://videos.churchgrowthfollowupministry.org/female_videos/asirvatham-video-20/",
                      "https://videos.churchgrowthfollowupministry.org/female_videos/asirvatham-video-21/",
                      "https://videos.churchgrowthfollowupministry.org/female_videos/asirvatham-video-22/"];
                      
  const Nithyavazhlvu =["https://videos.churchgrowthfollowupministry.org/female_videos/nithyavazlvu-video-1/",
                      "https://videos.churchgrowthfollowupministry.org/female_videos/nithyavazhvu-video-2/",
                      "https://videos.churchgrowthfollowupministry.org/female_videos/nithyavazhvu-video-3/",
                      "https://videos.churchgrowthfollowupministry.org/female_videos/nithyavazhvu-video-4/",
                      "https://videos.churchgrowthfollowupministry.org/female_videos/nithavazhvu-video-5/",
                      "https://videos.churchgrowthfollowupministry.org/female_videos/nithayvazhvu-video-6/",
                      "https://videos.churchgrowthfollowupministry.org/female_videos/nithyavazhvu-female-7/",
                      "https://videos.churchgrowthfollowupministry.org/female_videos/nithyavazhvu-video-8/",
                      "https://videos.churchgrowthfollowupministry.org/female_videos/nithyavazhvu-video-9/",
                      "https://videos.churchgrowthfollowupministry.org/female_videos/nithyavazhvu-video-10/",
                      "https://videos.churchgrowthfollowupministry.org/female_videos/nithyavazhvu-video-11/",
                      "https://videos.churchgrowthfollowupministry.org/female_videos/nithyavazhvu-video-12/",
                      "https://videos.churchgrowthfollowupministry.org/female_videos/nithyavazhvu-video-13/",
                      "https://videos.churchgrowthfollowupministry.org/female_videos/nithyavazhvu-video-14/",
                      "https://videos.churchgrowthfollowupministry.org/female_videos/nithyavazhvu-video-15/",
                      "https://videos.churchgrowthfollowupministry.org/female_videos/nithyavazhvu-video-15-2/",
                      "https://videos.churchgrowthfollowupministry.org/female_videos/nithyavazhvu-video-17/",
                      "https://videos.churchgrowthfollowupministry.org/female_videos/nithyavazhvu-video-18/",
                      "https://videos.churchgrowthfollowupministry.org/female_videos/nithyavazhvu-video-19/",
                      "https://videos.churchgrowthfollowupministry.org/female_videos/nithyavazhvu-video-20/",
                      "https://videos.churchgrowthfollowupministry.org/female_videos/nithyavazhvu-video-21/",
                      "https://videos.churchgrowthfollowupministry.org/female_videos/nithyavazhvu-video-22/"];
                      
const Anbu =["https://videos.churchgrowthfollowupministry.org/female_videos/anbu-video-1/",
            "https://videos.churchgrowthfollowupministry.org/female_videos/anbu-video-2/",
            "https://videos.churchgrowthfollowupministry.org/female_videos/anbu-video-3/",
            "https://videos.churchgrowthfollowupministry.org/female_videos/anbu-video-4/",
            "https://videos.churchgrowthfollowupministry.org/female_videos/anbu-video-5/",
            "https://videos.churchgrowthfollowupministry.org/female_videos/anbu-video-6/",
            "https://videos.churchgrowthfollowupministry.org/female_videos/anbu-video-7/",
            "https://videos.churchgrowthfollowupministry.org/female_videos/anbu-video-8/",
            "https://videos.churchgrowthfollowupministry.org/female_videos/anbu-video-9/",
            "https://videos.churchgrowthfollowupministry.org/female_videos/anbu-video-10/",
            "https://videos.churchgrowthfollowupministry.org/female_videos/anbu-video-11/",
            "https://videos.churchgrowthfollowupministry.org/female_videos/anbu-video-12-2/",
            "https://videos.churchgrowthfollowupministry.org/female_videos/anbu-video-13/",
            "https://videos.churchgrowthfollowupministry.org/female_videos/anbu-video-14/",
            "https://videos.churchgrowthfollowupministry.org/female_videos/anbu-video-15/",
            "https://videos.churchgrowthfollowupministry.org/female_videos/anbu-video-16/",
            "https://videos.churchgrowthfollowupministry.org/female_videos/anbu/",
            "https://videos.churchgrowthfollowupministry.org/female_videos/anbu-video-18/",
            "https://videos.churchgrowthfollowupministry.org/female_videos/anbu-video-19/",
            "https://videos.churchgrowthfollowupministry.org/female_videos/anbu-video-20/",
            "https://videos.churchgrowthfollowupministry.org/female_videos/anbu-video-21/",
            "https://videos.churchgrowthfollowupministry.org/female_videos/anbu-video-22/"];



const request = require('request');

//get believer details

function getBeliever(){
let beleiver;
let message;
var options = {
  method: 'GET',
  url: 'http://api.churchgrowthfollowupministry.org:3000/api/v1/believers',
  headers: 
   { 
     'content-type': 'application/json' 
     
   }
  };

request(options, function (error, response, body) {
  if (error) throw new Error(error);
 beleiver = JSON.parse(body);
 beleiver.forEach(function(elem){
  var id =elem.Id;
  var cate = elem.Category;
  var cou =elem.count;
  var phone = elem.phoneno;
  var gender =elem.gender;
  if(cate == 'Sugam' && gender == 'Female' && cou < 22){
    message= Sugam[cou];
    sendmessage(message,phone,cou,id);
    console.log(id);
  }
  if(cate == 'Samathanam' && gender == 'Female' && cou < 22){
    message= Samathanam[cou];
    sendmessage(message,phone,cou,id);
    console.log(id);
  }
  if(cate == 'Viduthalai' && gender == 'Female' && cou < 22){
    message= Viduthalai[cou];
    sendmessage(message,phone,cou,id);
    console.log(id);
  }
  if(cate == 'Anbu' && gender == 'Female' && cou < 22){
    message= Anbu[cou];
    sendmessage(message,phone,cou,id);
    console.log(id);
  }
  if(cate == 'Nithyavazhlvu' && gender == 'Female' && cou < 22){
    message= Nithyavazhlvu[cou];
    sendmessage(message,phone,cou,id);
    console.log(id);
  }
  if(cate == 'Manamthirumbuthal' && gender == 'Female' && cou < 22){
    message= Manamthirumbuthal[cou];
    sendmessage(message,phone,cou,id);
    console.log(id);
  }
  if(cate == 'Asirvatham' && gender == 'Female' && cou < 22){
    message= Asirvatham[cou];
    sendmessage(message,phone,cou,id);
    console.log(id);
  }


});
});
}

//Function to send message

function sendmessage(message,phone,cou,id){
var res;
const options = {
  method: 'POST',
  url: 'https://api.wassenger.com/v1/messages',
  headers: {'Content-Type': 'application/json', Token: '11b77007d28fa4dcaf0ae2a040317ef9dada8be0664b01f5b83995dd7599b90066803bcc2500a810'},
  body: {phone:phone, message: message},
  json: true,
  previewUrl:true
};

// Response 
const response = request(options, function (error, response, body) {
  if (error) throw new Error(error);
  res = body;
  console.log(res.status);
  if(res.status == 'queued'){
 //if response is successfully queued or ready to be send update the count value
   updateCount(id);
 }
});
}

//Update the Count value 

function updateCount(id){
  
var userid =id;
let url = 'http://api.churchgrowthfollowupministry.org:3000/api/v1/believers/'+userid;
console.log(url);
var options = { 
  method: 'PATCH',
  url:url ,
  headers: 
   { 
     'cache-control': 'no-cache',
     'content-type': 'application/json' } };

request(options, function (error, response, body) {
  if (error) throw new Error(error);

  console.log(body);
});

}


exports.handler = (event, context) => {
getBeliever();
};